<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>enoth.mesh</title>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f4f4f4; }
    .grid { display: grid; grid-template-columns: repeat(10, 30px); grid-gap: 5px; margin: 50px auto; width: max-content; }
    .cell { width: 30px; height: 30px; background: #ccc; border-radius: 5px; }
    .active { background: #4caf50; }
  </style>
</head>
<body>
  <h2>MQTT XY Matrix</h2>
  <div class="grid" id="grid"></div>
  <p>Status: <span id="status">Connecting...</span></p>

  <script>
    const client = mqtt.connect("wss://2557a86661894ebd8ac6bd385c47461d.s1.eu.hivemq.cloud:8883", {
      username: "mesh0",
      password: "WhoareWe123"
    });

    const gridSize = 10;
    const grid = document.getElementById("grid");

    for (let i = 0; i < gridSize * gridSize; i++) {
      const cell = document.createElement("div");
      cell.className = "cell";
      grid.appendChild(cell);
    }

    function highlightCell(x, y) {
      const index = y * gridSize + x;
      const cells = document.querySelectorAll(".cell");
      cells.forEach(c => c.classList.remove("active"));
      if (cells[index]) cells[index].classList.add("active");
    }

    client.on('connect', () => {
      document.getElementById("status").textContent = "Connected!";
      client.subscribe("mesh/coords");
    });

    client.on('message', (topic, message) => {
      const data = message.toString();
      console.log("Received:", data);
      try {
        const { x, y } = JSON.parse(data);
        highlightCell(x, y);
      } catch (e) {
        console.error("Invalid message:", data);
      }
    });

    client.on('error', err => {
      document.getElementById("status").textContent = "Error: " + err;
    });
  </script>
</body>
</html>
